<!DOCTYPE html>
<html>
<head>
  <title>Nouvelle vente</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #2F4F2F;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .wrapper {
      display: flex;
      gap: 60px;
      max-width: 1000px;
      width: 100%;
      height: 80vh;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      padding: 20px;
      box-sizing: border-box;
      align-items: center;
    }

    .container {
      flex: 1;
      height: 100%;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
    }

    th {
      background-color: #007AFF;
      color: white;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    select {
      padding: 5px;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    #addRowBtn {
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      align-self: flex-start;
      width: 150px;
      transition: background-color 0.3s ease;
    }
    #addRowBtn:hover { background-color: #1e7e34; }

    .sidebar {
      width: 200px;
      flex-shrink: 0;
      background: white;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
      gap: 12px;
    }

    .sidebar button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #FF3B30;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }
    .sidebar button:hover { background-color: #cc3027; }

    .sidebar .field {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 0 6px;
    }

    .sidebar label {
      font-size: 14px;
      font-weight: 700;
      text-align: center;
    }

    .sum-box {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      color: #007AFF;
      width: 100%;
    }

    a.saved-link, a.stats-link {
      display: block;
      width: 100%;
      text-align: center;
      text-decoration: none;
      background-color: #007AFF;
      color: white;
      padding: 10px 0;
      border-radius: 5px;
      font-weight: 600;
      margin-top: 10px;
    }
    a.saved-link:hover, a.stats-link:hover { background-color: #005bb5; }
  </style>
</head>

<body>
<div class="wrapper">
  <div class="container">
    <h1>Nouvelle vente</h1>
    <table>
      <thead>
        <tr>
          <th>Category</th>
          <th>Style</th>
          <th>Price per Unit</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
    <button id="addRowBtn">Add More Rows</button>
  </div>

  <div class="sidebar">
    <button id="resetBtn">ðŸ’¾ Sauvegarder</button>

    <div class="field">
      <label>Rabais (CHF)</label>
      <select id="discountSelect"><option value="0">0</option></select>
    </div>

    <div class="field">
      <label>Pourboire (CHF)</label>
      <select id="tipSelect"><option value="0">0</option></select>
    </div>

    <div class="sum-box">
      Total (CHF):<br><span id="totalPrice">0</span>
    </div>

    <a href="saved.html" class="saved-link">Toutes les ventes</a>
    <a href="stats.html" class="stats-link">ðŸ“Š Statistiques</a>
  </div>
</div>

<script>
const categories = ['Vinyls Neuf','Vinyls Occasion','Cassettes','Merch','Bar'];

const stylesByCategory = {
  'Vinyls Neuf': ['3CHF','Extra-EU','French/Recording','Hip-Hop','Electronic','Reggae/Dub','Rock','Jazz/Blues/Funk','Wave'],
  'Vinyls Occasion': ['3CHF','Extra-EU','French/Recording','Hip-Hop','Electronic','Reggae/Dub','Rock','Jazz/Blues/Funk','Wave'],
  'Cassettes': ['3CHF','Extra-EU','French/Recording','Hip-Hop','Electronic','Reggae/Dub','Rock','Jazz/Blues/Funk','Wave'],
  'Merch': ['Tshirt','Poids','Diamants'],
  'Bar': ['Caffe']
};

const tableBody = document.getElementById('tableBody');
const totalPriceSpan = document.getElementById('totalPrice');
const discountSelect = document.getElementById('discountSelect');
const tipSelect = document.getElementById('tipSelect');

for (let i=1;i<=20;i++){
  discountSelect.innerHTML+=`<option>${i}</option>`;
  tipSelect.innerHTML+=`<option>${i}</option>`;
}

function makePlaceholderOption(){
  const o=document.createElement('option');
  o.value="";o.textContent="-- select --";o.disabled=true;o.selected=true;
  return o;
}

function createRow(){
  const row=document.createElement('tr');

  const catSel=document.createElement('select');
  catSel.appendChild(makePlaceholderOption());
  categories.forEach(c=>catSel.innerHTML+=`<option>${c}</option>`);

  const styleSel=document.createElement('select');
  styleSel.appendChild(makePlaceholderOption());

  const priceSel=document.createElement('select');
  priceSel.appendChild(makePlaceholderOption());
  for(let p=1;p<=200;p++) priceSel.innerHTML+=`<option>${p}</option>`;

  catSel.addEventListener('change',()=>{
    styleSel.innerHTML='';
    styleSel.appendChild(makePlaceholderOption());
    (stylesByCategory[catSel.value]||[]).forEach(s=>{
      styleSel.innerHTML+=`<option>${s}</option>`;
    });
  });

  // â­ AUTO PRICE 3CHF â­
  styleSel.addEventListener('change',()=>{
    if(styleSel.value==='3CHF'){
      priceSel.value='3';
      updateTotal();
    }
  });

  priceSel.addEventListener('change',updateTotal);

  [catSel,styleSel,priceSel].forEach(s=>{
    const td=document.createElement('td');
    td.appendChild(s);
    row.appendChild(td);
  });

  return row;
}

for(let i=0;i<20;i++) tableBody.appendChild(createRow());

function updateTotal(){
  let sum=0;
  tableBody.querySelectorAll('tr').forEach(r=>{
    const v=r.cells[2].querySelector('select').value;
    if(v) sum+=Number(v);
  });
  totalPriceSpan.textContent=Math.max(sum-discountSelect.value+Number(tipSelect.value),0);
}

discountSelect.onchange=tipSelect.onchange=updateTotal;
</script>
</body>
</html>

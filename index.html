<!DOCTYPE html>
<html>
<head>
  <title>Nouvelle vente</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #2F4F2F;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .wrapper {
      display: flex;
      gap: 60px;
      max-width: 1000px;
      width: 100%;
      height: 80vh;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      padding: 20px;
      box-sizing: border-box;
      align-items: center;
    }

    .container {
      flex: 1;
      height: 100%;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
    }

    th {
      background-color: #007AFF;
      color: white;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    select {
      padding: 5px;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    #addRowBtn {
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      align-self: flex-start;
      width: 150px;
      transition: background-color 0.3s ease;
    }
    #addRowBtn:hover {
      background-color: #1e7e34;
    }

    .sidebar {
      width: 180px;
      flex-shrink: 0;
      background: white;
      border: none;
      box-shadow: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
    }

    .sidebar button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #FF3B30;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
    }

    .sidebar button:hover {
      background-color: #cc3027;
    }

    .sum-box {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      border: none;
      border-radius: 0;
      color: #007AFF;
      user-select: none;
      width: 100%;
      margin-bottom: 20px;
    }

    a.saved-link {
      display: block;
      width: 100%;
      text-align: center;
      text-decoration: none;
      background-color: #007AFF;
      color: white;
      padding: 10px 0;
      border-radius: 5px;
      font-weight: 600;
      margin-top: 10px;
    }

    a.saved-link:hover {
      background-color: #005bb5;
    }
  </style>
</head>
<body>

  <div class="wrapper">
    <div class="container">
      <h1>Nouvelle vente</h1>
      <table>
        <thead>
          <tr>
            <th>Category</th>
            <th>Style</th>
            <th>Price per Unit</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Rows generated by JS -->
        </tbody>
      </table>

      <button id="addRowBtn">Add More Rows</button>
    </div>

    <div class="sidebar">
      <button id="resetBtn">Reset Table</button>
      <div class="sum-box">
        Total Price:<br />
        <span id="totalPrice">0</span>
      </div>
      <a href="saved.html" class="saved-link">Toutes les ventes</a>
    </div>
  </div>

  <script>
    const categories = ['Neuf', 'Occasion', 'Bar', 'Autres'];
    const styles = ['Electronic', 'Jazz', 'African', 'Reggae', 'Rock', 'Hiphop', 'Autre'];
    const maxRows = 20;

    const tableBody = document.getElementById('tableBody');
    const totalPriceSpan = document.getElementById('totalPrice');
    const resetBtn = document.getElementById('resetBtn');
    const addRowBtn = document.getElementById('addRowBtn');

    function createRow() {
      const row = document.createElement('tr');

      // Category cell
      const categoryCell = document.createElement('td');
      const categorySelect = document.createElement('select');
      const emptyOptionCat = document.createElement('option');
      emptyOptionCat.value = "";
      emptyOptionCat.textContent = "-- select --";
      emptyOptionCat.selected = true;
      emptyOptionCat.disabled = true;
      categorySelect.appendChild(emptyOptionCat);
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });
      categoryCell.appendChild(categorySelect);
      row.appendChild(categoryCell);

      // Style cell
      const styleCell = document.createElement('td');
      const styleSelect = document.createElement('select');
      const emptyOptionStyle = document.createElement('option');
      emptyOptionStyle.value = "";
      emptyOptionStyle.textContent = "-- select --";
      emptyOptionStyle.selected = true;
      emptyOptionStyle.disabled = true;
      styleSelect.appendChild(emptyOptionStyle);
      styles.forEach(st => {
        const option = document.createElement('option');
        option.value = st;
        option.textContent = st;
        styleSelect.appendChild(option);
      });
      styleCell.appendChild(styleSelect);
      row.appendChild(styleCell);

      // Price cell
      const priceCell = document.createElement('td');
      const priceSelect = document.createElement('select');
      const emptyOptionPrice = document.createElement('option');
      emptyOptionPrice.value = "";
      emptyOptionPrice.textContent = "-- select --";
      emptyOptionPrice.selected = true;
      emptyOptionPrice.disabled = true;
      priceSelect.appendChild(emptyOptionPrice);
      for (let price = 1; price <= 200; price++) {
        const option = document.createElement('option');
        option.value = price;
        option.textContent = price;
        priceSelect.appendChild(option);
      }
      priceCell.appendChild(priceSelect);
      row.appendChild(priceCell);

      // Listener to update total
      priceSelect.addEventListener('change', updateTotal);

      return row;
    }

    // Generate initial rows
    for (let i = 0; i < maxRows; i++) {
      tableBody.appendChild(createRow());
    }

    function updateTotal() {
      let total = 0;
      const rows = tableBody.querySelectorAll('tr');
      rows.forEach(row => {
        const priceSelect = row.cells[2].querySelector('select'); // 3rd column
        if (priceSelect && priceSelect.value) {
          total += Number(priceSelect.value);
        }
      });
      totalPriceSpan.textContent = total;
    }

    resetBtn.addEventListener('click', () => {
      saveSnapshot();
      const rows = tableBody.querySelectorAll('tr');
      rows.forEach(row => {
        row.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
      });
      updateTotal();
    });

    function saveSnapshot() {
      const rows = tableBody.querySelectorAll('tr');
      let snapshot = {
        time: new Date().toISOString(),
        entries: []
      };
      rows.forEach(row => {
        const categorySelect = row.cells[0].querySelector('select');
        const styleSelect = row.cells[1].querySelector('select');
        const priceSelect = row.cells[2].querySelector('select');
        if (categorySelect.value && styleSelect.value && priceSelect.value) {
          snapshot.entries.push({
            category: categorySelect.value,
            style: styleSelect.value,
            price: Number(priceSelect.value)
          });
        }
      });
      if (snapshot.entries.length === 0) return;
      let savedSnapshots = JSON.parse(localStorage.getItem('savedSnapshots') || "[]");
      savedSnapshots.push(snapshot);
      localStorage.setItem('savedSnapshots', JSON.stringify(savedSnapshots));
    }

    addRowBtn.addEventListener('click', () => {
      for (let i = 0; i < 10; i++) {
        tableBody.appendChild(createRow());
      }
    });

    updateTotal();
  </script>

</body>
</html>

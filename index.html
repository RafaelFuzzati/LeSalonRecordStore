<!DOCTYPE html>
<html>
<head>
  <title>Nouvelle vente</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #2F4F2F; /* RAL 6005 */
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #FF69B4; /* pink main text */
    }

    .wrapper {
      display: flex;
      gap: 60px;
      max-width: 1000px;
      width: 100%;
      height: 80vh;
      background: #2F4F2F; /* RAL 6005 */
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      padding: 20px;
      box-sizing: border-box;
      align-items: center;
    }

    .container {
      flex: 1;
      height: 100%;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #2F4F2F; /* RAL 6005 */
      color: black;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
      color: black;
    }

    th {
      background-color: #2F4F2F;
      color: black;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    select {
      padding: 5px;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
      color: black;
    }

    .sidebar {
      width: 180px;
      flex-shrink: 0;
      background: transparent;
      border: none;
      box-shadow: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
      color: #FF69B4; /* pink text */
    }

    .sidebar button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #FF69B4; /* pink */
      color: black; /* black text on pink */
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
    }

    .sidebar button:hover {
      background-color: #e063a1;
    }

    .sum-box {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      border: none;
      border-radius: 0;
      color: #FF69B4; /* pink */
      user-select: none;
      width: 100%;
      margin-bottom: 20px;
    }

    a.saved-link {
      display: block;
      width: 100%;
      text-align: center;
      text-decoration: none;
      background-color: #FF69B4; /* pink */
      color: black;
      padding: 10px 0;
      border-radius: 5px;
      font-weight: 600;
      margin-top: 10px;
    }

    a.saved-link:hover {
      background-color: #e063a1;
    }
  </style>
</head>
<body>

  <div class="wrapper">
    <div class="container">
      <h1>Nouvelle vente</h1>
      <table>
        <thead>
          <tr>
            <th>Category</th>
            <th>Price per Unit</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Rows generated by JS -->
        </tbody>
      </table>
      <button id="addRowBtn" style="margin-top:10px; padding:8px 16px; font-size:14px; background:#FF69B4; color:black; border:none; border-radius:5px; cursor:pointer;">Add More Rows</button>
    </div>

    <div class="sidebar">
      <button id="resetBtn">Reset Table</button>
      <div class="sum-box">
        Total Price:<br />
        <span id="totalPrice">0</span>
      </div>
      <a href="saved.html" class="saved-link">Toutes les ventes</a>
    </div>
  </div>

  <script>
    const categories = ['Neuf', 'Occasion', 'Bar', 'Autres'];
    const maxRows = 200;
    let currentRows = 20;

    const tableBody = document.getElementById('tableBody');
    const totalPriceSpan = document.getElementById('totalPrice');
    const resetBtn = document.getElementById('resetBtn');
    const addRowBtn = document.getElementById('addRowBtn');

    function createRow() {
      const row = document.createElement('tr');

      // Category dropdown cell
      const categoryCell = document.createElement('td');
      const categorySelect = document.createElement('select');

      const emptyOptionCat = document.createElement('option');
      emptyOptionCat.value = "";
      emptyOptionCat.textContent = "-- select --";
      emptyOptionCat.selected = true;
      emptyOptionCat.disabled = true;
      categorySelect.appendChild(emptyOptionCat);

      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });
      categoryCell.appendChild(categorySelect);
      row.appendChild(categoryCell);

      // Price dropdown cell
      const priceCell = document.createElement('td');
      const priceSelect = document.createElement('select');

      const emptyOptionPrice = document.createElement('option');
      emptyOptionPrice.value = "";
      emptyOptionPrice.textContent = "-- select --";
      emptyOptionPrice.selected = true;
      emptyOptionPrice.disabled = true;
      priceSelect.appendChild(emptyOptionPrice);

      for (let price = 1; price <= 200; price++) {
        const option = document.createElement('option');
        option.value = price;
        option.textContent = price;
        priceSelect.appendChild(option);
      }
      priceCell.appendChild(priceSelect);
      row.appendChild(priceCell);

      // Add event listener to price select for updating total
      priceSelect.addEventListener('change', updateTotal);

      return row;
    }

    function addRows(num) {
      for (let i = 0; i < num; i++) {
        if (currentRows < maxRows) {
          const newRow = createRow();
          tableBody.appendChild(newRow);
          currentRows++;
        }
      }
    }

    // Initialize 20 rows
    addRows(20);

    function updateTotal() {
      let total = 0;
      const rows = tableBody.querySelectorAll('tr');
      rows.forEach(row => {
        const priceSelect = row.cells[1].querySelector('select');
        const val = priceSelect.value;
        if (val) {
          total += Number(val);
        }
      });
      totalPriceSpan.textContent = total;
    }

    // Save current full rows + timestamp to localStorage
    function saveSnapshot() {
      const rows = tableBody.querySelectorAll('tr');
      let snapshot = {
        time: new Date().toISOString(),
        entries: []
      };

      rows.forEach(row => {
        const categorySelect = row.cells[0].querySelector('select');
        const priceSelect = row.cells[1].querySelector('select');

        if (categorySelect.value && priceSelect.value) {
          snapshot.entries.push({
            category: categorySelect.value,
            price: Number(priceSelect.value)
          });
        }
      });

      if (snapshot.entries.length === 0) {
        return; // nothing to save
      }

      // Get existing snapshots from localStorage
      let savedSnapshots = JSON.parse(localStorage.getItem('savedSnapshots') || "[]");
      savedSnapshots.push(snapshot);
      localStorage.setItem('savedSnapshots', JSON.stringify(savedSnapshots));
    }

    resetBtn.addEventListener('click', () => {
      saveSnapshot();

      const rows = tableBody.querySelectorAll('tr');
      rows.forEach(row => {
        const categorySelect = row.cells[0].querySelector('select');
        const priceSelect = row.cells[1].querySelector('select');
        categorySelect.selectedIndex = 0;
        priceSelect.selectedIndex = 0;
      });
      updateTotal();
    });

    addRowBtn.addEventListener('click', () => {
      addRows(10); // Add 10 more rows per click
    });
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Nouvelle vente</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;margin:0;padding:20px;background:#2F4F2F;height:100vh;display:flex;justify-content:center;align-items:center}
.wrapper{display:flex;gap:60px;max-width:1000px;width:100%;height:80vh;background:#fff;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.1);padding:20px}
.container{flex:1;overflow-y:auto}
.sidebar{width:200px;display:flex;flex-direction:column;gap:10px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#007AFF;color:#fff}
select,button{padding:6px;font-size:14px}
button{cursor:pointer}
.sum-box{font-size:18px;font-weight:700;color:#007AFF;text-align:center}
a{background:#007AFF;color:#fff;text-decoration:none;padding:8px;text-align:center;border-radius:6px}
</style>
</head>

<body>
<div class="wrapper">
  <div class="container">
    <h1>Nouvelle vente</h1>
    <table>
      <thead><tr><th>CatÃ©gorie</th><th>Style</th><th>Prix</th></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>
    <button id="addRowBtn">Ajouter lignes</button>
  </div>

  <div class="sidebar">
    <button id="saveBtn">ðŸ’¾ Sauvegarder</button>

    <label>Rabais (CHF)
      <select id="discount"><option value="0">0</option></select>
    </label>

    <label>Pourboire (CHF)
      <select id="tip"><option value="0">0</option></select>
    </label>

    <div class="sum-box">Total: <span id="total">0</span> CHF</div>

    <a href="saved.html">Toutes les ventes</a>
    <a href="stats.html">ðŸ“Š Statistiques</a>
  </div>
</div>

<script>
const categories=['Neuf','Occasion','Autres'];
const styles=['Rock','Jazz','Electronic','Hip-Hop','Reggae','Cassette','T-shirt','Coffee'];
const tableBody=document.getElementById('tableBody');
const totalSpan=document.getElementById('total');
const discountSel=document.getElementById('discount');
const tipSel=document.getElementById('tip');

for(let i=1;i<=20;i++){
  discountSel.innerHTML+=`<option>${i}</option>`;
  tipSel.innerHTML+=`<option>${i}</option>`;
}

function row(){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><select><option></option>${categories.map(c=>`<option>${c}</option>`).join('')}</select></td>
    <td><select><option></option>${styles.map(s=>`<option>${s}</option>`).join('')}</select></td>
    <td><select><option></option>${Array.from({length:200},(_,i)=>`<option>${i+1}</option>`).join('')}</select></td>
  `;
  tr.querySelectorAll('select')[2].onchange=update;
  return tr;
}

for(let i=0;i<10;i++) tableBody.appendChild(row());

function subtotal(){
  let s=0;
  tableBody.querySelectorAll('tr').forEach(r=>{
    const v=r.children[2].querySelector('select').value;
    if(v) s+=+v;
  });
  return s;
}

function update(){
  totalSpan.textContent=Math.max(subtotal()-(+discountSel.value)+(+tipSel.value),0);
}

discountSel.onchange=tipSel.onchange=update;

document.getElementById('saveBtn').onclick=()=>{
  const entries=[];
  tableBody.querySelectorAll('tr').forEach(r=>{
    const c=r.children[0].firstChild.value;
    const s=r.children[1].firstChild.value;
    const p=r.children[2].firstChild.value;
    if(c&&s&&p) entries.push({category:c,style:s,price:+p});
  });
  if(!entries.length) return;

  const data=JSON.parse(localStorage.getItem('savedSnapshots')||'[]');
  data.push({
    time:new Date().toISOString(),
    discount:+discountSel.value,
    tip:+tipSel.value,
    entries
  });
  localStorage.setItem('savedSnapshots',JSON.stringify(data));
  location.reload();
};

document.getElementById('addRowBtn').onclick=()=>tableBody.appendChild(row());
update();
</script>
</body>
</html>
